<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>База людей и ALPR</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <!-- Статусбар -->
    <div id="statusBar">
        <div class="left">
            <button id="btnStatus" onclick="toggleStatus()">
                Статус <span id="statusIndicator"></span>
            </button>
        </div>
        <div class="right">
            <span id="statusTime">--:--:--</span>
        </div>
    </div>

    <!-- Модал для статусов -->
    <div id="statusModal" class="status-modal" role="dialog" style="display: none;">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <strong>Статус сервера</strong>
            <button onclick="toggleStatus()">Закрыть</button>
        </div>
        <div style="margin-top:8px;">
            <div><strong>MQTT:</strong> <span id="modalMQTT"></span></div>
            <div><strong>CPAI:</strong> <span id="modalCPAI"></span></div>
        </div>
    </div>

    <!-- Вкладки -->
    <div class="tabs">
        <div class="tab active" onclick="showTab('peopleTab', event)">Люди и авто</div>
        <div class="tab" onclick="showTab('pointsTab', event)">Точки доступа</div>
        <div class="tab" onclick="showTab('historyTab', event)">История событий</div>
        <div class="tab" onclick="showTab('logTab', event)">Лог ALPR</div>
        <div class="tab" onclick="showTab('settingsTab', event)">Настройки</div>
    </div>

    <!-- Люди -->
    <div id="peopleTab" class="tab-content">
        <h2>Поиск</h2>
        <input id="searchPeople" placeholder="Поиск по людям">

        <h2>Добавить человека</h2>
        <input id="name" placeholder="ФИО">
        <input id="car_number" placeholder="Номер авто">
        <input id="car_model" placeholder="Марка авто">
        <input id="phone" placeholder="Телефон">
        <input id="address" placeholder="Адрес">
        <button onclick="addPerson()">Добавить</button>

        <h2>Список людей</h2>
        <table id="peopleTable">
            <thead>
                <tr>
                    <th>ФИО</th>
                    <th>Номер авто</th>
                    <th>Марка авто</th>
                    <th>Телефон</th>
                    <th>Адрес</th>
                    <th>Действия</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Точки доступа -->
    <div id="pointsTab" class="tab-content" style="display:none;">
        <h2>Поиск</h2>
        <input id="searchPoints" placeholder="Поиск по точкам">

        <h2>Добавить точку доступа</h2>
        <input id="point_name" placeholder="Имя точки">
        <input id="point_rtp_in" placeholder="RTP/RTSP камера IN">
        <input id="point_rtp_out" placeholder="RTP/RTSP камера OUT">
        <button onclick="addPoint()">Добавить</button>

        <h2>Список точек</h2>
        <table id="pointsTable">
            <thead>
                <tr>
                    <th>Имя</th>
                    <th>MQTT ветка</th>
                    <th>IN камера</th>
                    <th>OUT камера</th>
                    <th>Миниатюры</th>
                    <th>Действия</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Лог -->
    <div id="logTab" class="tab-content" style="display:none;">
        <h2>Лог ALPR</h2>
        <label>
            <input type="checkbox" id="chkAutoScroll" checked> Автопрокрутка
        </label>
        <label>
            <input type="checkbox" id="chkDebug"> Debug
        </label>
        <pre id="logOutput"></pre>
        <button onclick="refreshLog()">Обновить лог</button>
    </div>

    <!-- Настройки -->
    <div id="settingsTab" class="tab-content" style="display:none;">
        <h2>Настройки сервера</h2>

        <label>MQTT сервер:</label>
        <input id="mqttHost" placeholder="Адрес">
        <input id="mqttPort" placeholder="Порт" style="width:60px;">
        <br>

        <label>MQTT ветка (base):</label>
        <input id="mqttBase" placeholder="ALPR">
        <br>

        <label>CPAI сервер:</label>
        <input id="cpaiHost" placeholder="192.168.12.11">
        <input id="cpaiPort" placeholder="32168" style="width:60px;">
        <br>

        <label>Путь до базы (base.db):</label>
        <input id="baseDb" placeholder="base.db"><br>

        <label>Путь до миниатюр:</label>
        <input id="snapshotsPath" placeholder="static/snapshots">
        <br>

        <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;">
            <button onclick="saveSettings()">Сохранить</button>
            <button id="btnRestart" onclick="restartService()">Перезапустить сервер (службу)</button>
        </div>
    </div>

    <!-- История событий -->
    <div id="historyTab" class="tab-content" style="display:none;">
        <h2>История событий</h2>

        <div class="filters" style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
            <input id="histSearch" placeholder="Поиск по номеру (часть)">
            <label>С даты: <input type="date" id="histFrom"></label>
            <label>По дату: <input type="date" id="histTo"></label>
            <button onclick="applyHistoryFilters()">Найти</button>
            <button onclick="resetHistoryFilters()">Сброс</button>
        </div>

        <h3 style="margin-top:12px;">Результаты</h3>
        <table id="historyTable">
            <thead>
                <tr>
                    <th>Дата/время</th>
                    <th>Номер</th>
                    <th>Точка</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <div class="pager" style="margin-top:10px; display:flex; gap:12px; align-items:center;">
            <button id="histPrev" disabled>Назад</button>
            <span id="histInfo">—</span>
            <button id="histNext" disabled>Вперёд</button>
        </div>
    </div>

    <script src="/static/script.js"></script>
</body>
</html>
